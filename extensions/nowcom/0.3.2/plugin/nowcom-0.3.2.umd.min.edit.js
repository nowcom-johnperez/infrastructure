(("undefined"!==typeof self?self:this)["webpackJsonpnowcom_0_3_2"]=("undefined"!==typeof self?self:this)["webpackJsonpnowcom_0_3_2"]||[]).push([[1],{ca6e5:function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e._self._c;return e.$fetchState.pending?t("Loading"):t("CruResource",{attrs:{"done-route":e.doneRouteProject,mode:e.mode,resource:e.value,subtypes:[],"validation-passed":!0,errors:e.errors,"apply-hooks":e.applyHooks,"cancel-event":!0},on:{error:t=>e.errors=t,finish:e.save,cancel:e.cancelForm}},[e.isView?e._e():t("NameNsDescription",{attrs:{value:e.value,namespaced:!1,mode:e.mode,"extra-columns":["project-col"]},scopedSlots:e._u([e.flatView&&e.isCreate?{key:"project-col",fn:function(){return[t("LabeledSelect",{attrs:{"data-testid":"name-ns-description-project",label:e.t("namespace.project.label"),options:e.projectOpts},model:{value:e.projectName,callback:function(t){e.projectName=t},expression:"projectName"}})]},proxy:!0}:null],null,!0)}),t("ResourceTabs",{attrs:{mode:e.mode,"side-tabs":!0},model:{value:e.value,callback:function(t){e.value=t},expression:"value"}},[e.showResourceQuota?t("Tab",{attrs:{weight:1,name:"container-resource-quotas",label:e.t("namespace.resourceQuotas")}},[t("div",{staticClass:"row"},[t("div",{staticClass:"col span-12"},[t("p",{staticClass:"helper-text mb-10"},[e.mode===e.viewMode?t("t",{attrs:{k:"resourceQuota.helpTextDetail"}}):t("t",{attrs:{k:"resourceQuota.helpText"}}),e.showHarvesterHelpText?t("span",[e._v(" "+e._s(e.t("resourceQuota.helpTextHarvester"))+" ")]):e._e()],1)])]),t("ResourceQuota",{attrs:{mode:e.mode,project:e.project,types:e.isStandaloneHarvester?e.HARVESTER_TYPES:e.RANCHER_TYPES},model:{value:e.value,callback:function(t){e.value=t},expression:"value"}})],1):e._e(),e.showContainerResourceLimit?t("Tab",{attrs:{weight:0,name:"container-resource-limit",label:e.t("namespace.containerResourceLimit")}},[t("ContainerResourceLimit",{key:JSON.stringify(e.containerResourceLimits),attrs:{value:e.containerResourceLimits,mode:e.mode,namespace:e.value,"register-before-hook":e.registerBeforeHook}})],1):e._e(),t("Tab",{attrs:{name:"labels-and-annotations","label-key":"generic.labelsAndAnnotations",weight:-1}},[t("Labels",{key:e.rerenderNums,attrs:{"default-container-class":"labels-and-annotations-container",value:e.value,mode:e.mode,"display-side-by-side":!1}})],1),e.showPodSecurityAdmission?t("Tab",{attrs:{name:"pod-security-admission","label-key":"podSecurityAdmission.name",label:e.t("podSecurityAdmission.name")}},[t("PodSecurityAdmission",{attrs:{labels:e.value.labels,mode:e.mode,"labels-prefix":"pod-security.kubernetes.io/"},on:{updateLabels:e.PSAChanged}})],1):e._e()],1),e.projects?t("MoveModal"):e._e()],1)},r=[],i=a("9ce4"),o=a("3c8c"),n=a("305c"),l=a("466b"),c=a("907c"),u=a("4ac6"),d=a("93d9"),m=a("bd9c"),p=a("38de"),h=a("c422"),v=a("fd5f"),b=a("da25"),f=a("b7b8"),R=a("8aa3"),j=a("15ca"),E=a("2587"),T=a("b648"),y=a("4442"),w=a("2cb5"),g=a("bb60"),L=a("dd79");const{CLUSTER:P}=Object(L["a"])();var C={components:{ContainerResourceLimit:d["a"],CruResource:v["a"],LabeledSelect:l["a"],Labels:y["a"],Loading:j["a"],NameNsDescription:o["a"],PodSecurityAdmission:m["a"],ResourceQuota:R["a"],Tab:p["a"],ResourceTabs:h["a"],MoveModal:f["a"]},mixins:[n["a"]],async fetch(){this.$store.getters["management/schemaFor"](c["n"].PROJECT)&&(this.projects=await this.$store.dispatch("management/findAll",{type:c["n"].PROJECT}),this.project=this.projects.find(e=>e.id.includes(this.projectName)))},data(){var e,t,a;let s=null;null!==(e=this.liveValue)&&void 0!==e&&null!==(e=e.metadata)&&void 0!==e&&e.name&&(s=this.liveValue.metadata.name+"/default-quota");const r=(null===(t=this.value)||void 0===t||null===(t=t.metadata)||void 0===t||null===(t=t.labels)||void 0===t?void 0:t[u["j"]])||this.$route.query[b["f"]];return{originalQuotaId:s,project:null,projects:null,viewMode:b["u"],containerResourceLimits:(null===(a=this.value.annotations)||void 0===a?void 0:a[u["d"]])||this.getDefaultContainerResourceLimits(r),rerenderNums:Object(w["m"])(4),projectName:r,HARVESTER_TYPES:E["a"],RANCHER_TYPES:E["c"]}},computed:{...Object(i["b"])(["isStandaloneHarvester"]),isCreate(){return this.mode===b["l"]},projectOpts(){const e=this.$store.getters["currentCluster"].id;let t=this.$store.getters["management/all"](c["n"].PROJECT);t=t.filter(t=>{var a;return(null===(a=t.spec)||void 0===a?void 0:a.clusterName)===e});const a=t.map(e=>({label:e.nameDisplay,value:e.metadata.name}));return a.unshift({label:this.t("namespace.project.none"),value:null}),a},doneLocationOverride(){return this.value.listLocation},showResourceQuota(){var e;return!this.isStandaloneHarvester&&Object.keys((null===(e=this.project)||void 0===e||null===(e=e.spec)||void 0===e||null===(e=e.resourceQuota)||void 0===e?void 0:e.limit)||{}).length>0},showContainerResourceLimit(){return!this.isStandaloneHarvester},flatView(){return this.$route.query[b["c"]]||!1},showPodSecurityAdmission(){return!this.isStandaloneHarvester},showHarvesterHelpText(){return!this.isStandaloneHarvester&&this.$store.getters["currentProduct"].inStore===T["a"]},doneRouteProject(){return{name:`${g["k"]}-c-cluster-${g["m"]}`,params:{cluster:P}}}},watch:{project(){const e=this.getDefaultContainerResourceLimits(this.projectName);this.$set(this,"containerResourceLimits",e)},projectName(e){this.$set(this,"project",this.projects.find(t=>t.id.includes(e)))}},created(){this.registerBeforeHook(this.willSave,"willSave")},methods:{willSave(){var e;const t=this.$store.getters["currentCluster"],a=null===(e=this.project)||void 0===e?void 0:e.id.split("/")[1],s=a?`${t.id}:${a}`:null;this.value.setLabel(u["j"],a),this.value.setAnnotation(u["j"],s)},getDefaultContainerResourceLimits(e){var t;if(!e)return;const a=this.$store.getters["management/all"](c["n"].PROJECT),s=a.find(t=>t.id.includes(e));return(null===s||void 0===s||null===(t=s.spec)||void 0===t?void 0:t.containerDefaultResourceLimit)||{}},PSAChanged(e){this.value.setLabels(e),this.rerenderNums=Object(w["m"])(4)},cancelForm(){this.$router.replace(this.doneRouteProject)}}},S=C,_=a("d802"),O=Object(_["a"])(S,s,r,!1,null,null,null);t["default"]=O.exports},d019:function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e._self._c;return t("CruResource",{staticClass:"project",attrs:{"done-route":e.doneRouteProject,errors:e.fvUnreportedValidationErrors,mode:e.mode,resource:e.value,subtypes:[],"can-yaml":!1,"validation-passed":e.fvFormIsValid,"cancel-event":!0},on:{error:t=>e.errors=t,finish:e.save,cancel:e.cancelForm}},[t("NameNsDescription",{attrs:{"name-editable":!0,mode:e.mode,namespaced:!1,"description-key":"spec.description","description-disabled":e.isDescriptionDisabled,"name-key":"spec.displayName","normalize-name":!1,rules:{name:e.fvGetAndReportPathRules("spec.displayName"),namespace:[],description:[]}},model:{value:e.value,callback:function(t){e.value=t},expression:"value"}}),t("Tabbed",{attrs:{"side-tabs":!0}},[e.canViewMembers?t("Tab",{attrs:{name:"members",label:e.t("project.members.label"),weight:10}},[e.showBannerForOnlyManagingMembers?t("Banner",{attrs:{color:"info",label:e.t("project.membersEditOnly")}}):e._e(),t("ProjectMembershipEditor",{attrs:{mode:e.mode,"parent-id":e.value.id},on:{"has-owner-changed":e.onHasOwnerChanged,"membership-update":e.onMembershipUpdate}})],1):e._e(),t("Tab",{attrs:{name:"resource-quotas",label:e.t("project.resourceQuotas"),weight:9}},[t("ResourceQuota",{attrs:{mode:e.canEditTabElements,types:e.isHarvester?e.HARVESTER_TYPES:e.RANCHER_TYPES},on:{remove:e.removeQuota},model:{value:e.value,callback:function(t){e.value=t},expression:"value"}})],1),t("Tab",{attrs:{name:"container-default-resource-limit",label:e.resourceQuotaLabel,weight:8}},[t("ContainerResourceLimit",{attrs:{mode:e.canEditTabElements,"show-tip":!1,"register-before-hook":e.registerBeforeHook},model:{value:e.value.spec.containerDefaultResourceLimit,callback:function(t){e.$set(e.value.spec,"containerDefaultResourceLimit",t)},expression:"value.spec.containerDefaultResourceLimit"}})],1),t("Tab",{attrs:{name:"labels-and-annotations","label-key":"generic.labelsAndAnnotations",weight:7}},[t("Labels",{attrs:{"default-container-class":"labels-and-annotations-container",value:e.value,mode:e.canEditTabElements,"display-side-by-side":!1}})],1)],1)],1)},r=[],i=a("9ce4"),o=a("93d9"),n=a("305c"),l=a("ebab"),c=a("fd5f"),u=a("4442"),d=a("dff8"),m=a("2587"),p=a("38de"),h=a("0cb2"),v=a("3c8c"),b=a("907c"),f=a("bcb3"),R=a("da25"),j=a("fa51"),E=a("b648"),T=a("6418"),y=a("bb60"),w=a("dd79");const{CLUSTER:g}=Object(w["a"])();var L={components:{ContainerResourceLimit:o["a"],CruResource:c["a"],Labels:u["a"],NameNsDescription:v["a"],ProjectMembershipEditor:j["b"],ResourceQuota:d["a"],Tabbed:h["a"],Tab:p["a"],Banner:T["a"]},mixins:[n["a"],l["a"]],data(){var e,t;return this.$set(this.value,"spec",this.value.spec||{}),this.$set(this.value.spec,"podSecurityPolicyTemplateId",(null===(e=this.value.status)||void 0===e?void 0:e.podSecurityPolicyTemplateId)||""),{projectRoleTemplateBindingSchema:this.$store.getters["management/schemaFor"](b["n"].PROJECT_ROLE_TEMPLATE_BINDING),createLocation:{name:"c-cluster-product-resource-create",params:{product:f["a"],resource:b["n"].PROJECT_ROLE_TEMPLATE_BINDING},query:{[R["f"]]:null===(t=this.project)||void 0===t||null===(t=t.id)||void 0===t?void 0:t.replace("/",":")}},resource:b["n"].PROJECT_ROLE_TEMPLATE_BINDING,saveBindings:null,membershipHasOwner:!1,membershipUpdate:{},HARVESTER_TYPES:m["a"],RANCHER_TYPES:m["c"],fvFormRuleSets:[{path:"spec.displayName",rules:["required"]}]}},computed:{...Object(i["b"])(["currentCluster"]),canViewMembers(){return Object(j["a"])(this.$store)},canEditProject(){var e;return null===(e=this.value)||void 0===e||null===(e=e.links)||void 0===e?void 0:e.update},isDescriptionDisabled(){return this.mode===R["n"]&&!this.canEditProject||!1},canEditTabElements(){return this.mode!==R["n"]||this.canEditProject?this.mode:R["u"]},showBannerForOnlyManagingMembers(){return this.mode===R["n"]&&!this.canEditProject},isK3s(){var e;return((null===(e=this.currentCluster)||void 0===e||null===(e=e.spec)||void 0===e?void 0:e.kubernetesVersion)||"").includes("k3s")},isHarvester(){return this.$store.getters["currentProduct"].inStore===E["a"]},resourceQuotaLabel(){return this.isHarvester?this.t("project.vmDefaultResourceLimit"):this.t("project.containerDefaultResourceLimit")},doneRouteProject(){return{name:`${y["k"]}-c-cluster-${y["m"]}`,params:{cluster:g}}}},watch:{hasOwner(){this.errors=this.hasOwner?[]:[this.t("project.haveOneOwner")]}},created(){this.$set(this.value.metadata,"namespace",this.$store.getters["currentCluster"].id),this.$set(this.value,"spec",this.value.spec||{}),this.$set(this.value.spec,"containerDefaultResourceLimit",this.value.spec.containerDefaultResourceLimit||{})},methods:{async save(e){try{if(this.errors=[],this.mode===R["l"]){const e=await this.value.save();this.membershipUpdate.save&&await this.membershipUpdate.save(e.id)}else if(this.mode===R["n"]&&(this.canEditProject&&(await this.value.save(!0),await this.$store.dispatch("management/find",{type:b["n"].PROJECT,id:this.value.id,opt:{force:!0}})),this.membershipUpdate.save)){const e=await this.value.norman;await this.membershipUpdate.save(e.id)}e(!0),this.$router.replace(this.doneRouteProject)}catch(t){this.errors.push(t),e(!1)}},onHasOwnerChanged(e){this.$set(this,"membershipHasOwner",e)},onMembershipUpdate(e){this.$set(this,"membershipUpdate",e)},removeQuota(e){["resourceQuota","namespaceDefaultResourceQuota"].forEach(t=>{var a,s,r,i,o,n;null!==(a=this.value)&&void 0!==a&&null!==(a=a.spec[t])&&void 0!==a&&a.limit&&null!==(s=this.value)&&void 0!==s&&null!==(s=s.spec[t])&&void 0!==s&&s.limit[e]&&(null===(o=this.value)||void 0===o||null===(o=o.spec[t])||void 0===o||delete o.limit[e]);null!==(r=this.value)&&void 0!==r&&null!==(r=r.spec[t])&&void 0!==r&&r.usedLimit&&null!==(i=this.value)&&void 0!==i&&null!==(i=i.spec[t])&&void 0!==i&&i.usedLimit[e]&&(null===(n=this.value)||void 0===n||null===(n=n.spec[t])||void 0===n||delete n.usedLimit[e])})},cancelForm(){this.$router.replace(this.doneRouteProject)}}},P=L,C=a("d802"),S=Object(C["a"])(P,s,r,!1,null,null,null);t["default"]=S.exports}}]);
//# sourceMappingURL=nowcom-0.3.2.umd.min.edit.js.map